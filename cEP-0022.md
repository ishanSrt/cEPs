# Quickstart Green Mode

| Metadata |                                               |
| -------- | --------------------------------------------- |
| cEP      | 22                                            |
| Version  | 1.0                                           |
| Title    | Quickstart Green Mode                         |
| Authors  | Ishan Srivastava <mailto:ishan.srt@gmail.com> |
| Status   | Implementation Due                            |
| Type     | Feature                                       |

# Abstract

This document describes what is the **Green Mode** for `coala-quickstart` and how
will this be implemented.

This cEP describes new type of config files which will be generated by
`coala-quickstart`, how will they be different from the ones currently being
created, how is this helpful and the action-plan for adding this feature.

# Introduction

Currently `coala-quickstart` generates config files which point out too many
errors in the code-base of the project. It also asks too many questions
while generating the config file. The config files are not that specific to
the project and the errors pointed out by coala when operated on the config
files produced are generally undesirable for the project owners. 

Project owners need a configuration file which *agrees* with their codestyle, is
as specific as possible i.e. can point out maximum errors with least amount
of manual edits it in the future, for future inconsistencies in commits.
Many organizations don't follow specific code styles like `PEP8`, instead they
follow their own standards. We need to adapt to those standards with least
user interaction and produce config files which generate absolutely no errors
in their codebase. This will lead to easier adoption of coala across communities
as it is going to result in an easy mergeable PR in the orgs.

# Implementation

This project will be implemented in two phases:

- The Brute Force way
- Further optimization on the Brute Force

1. The first step will consist of preparing a dict of all the values that can
   be attained by the bears' settings, may it be necessary or optional as we need
   to create *green* config files that are as specific as possible. Failure to do
   so will lead to dropping of most **optional** bear settings, thus will lead to
   coala not detecting many inconsistencies, and the developers of the project will
   have to do the work of learning about the bears and their settings and then
   modifying the `.coafile` manually, while not able to guess the correct
   **necessary** bear settings will lead to dropping of bears themselves.

**The following steps mainly describe the brute force way**

2. Certain thresholds may be defined for an org based on several factors
   for the number of inconsistencies detected to be considered mistakes however
   these shall be stored for later as the first and formost goal of this project
   is to generate completely *"green"* config files.

3. coala will be ran over and over again for the entire project with all
   instances of bears with all the combinations of settings running in
   parallel, as soon as instances of a particular setting is done and we get
   a value for the setting for which no errors were generated, it goes directly
   into the `.coafile`, if no value for an optional setting matches, the setting will
   have to be dropped,  while if no necessary setting is found out to be *green*,
   the entire bear will have to be dropped, keeping at the back (of our heads) that,
   certain settings producing number of errors within the threshold as described in
   step 2 are being saved for later.

4. Once we have collected this data and using the metadata already being
   collected from `coala-quickstart` we will generate the first and formost complete
   *green* config file.

5. The additional data generated for erranious settings within a theshold can
   be reported later to the project administrators in any form and wait for their
   decision whether these are actual codestyles or mistakes. In case of mistakes,
   `coala-quickstart` should have the ability to add these rules automatically
   to the config file. In case these are actual codestyles, `coala-quickstart`
   should store this data for use in the next phase.

# Improving upon the Brute Force

Premature optimization should not be performed on anything
although some of the limitations of the brute force method are clear even
at the beginning. We try to rush through the brute force as quick as possible
and in the mean time keep on thinking of enhancing this in ways to detect more
specific bear settings and reducing the total run time of itself.

## The *"lite-mode"*

From what is evident, the brute-force is going to take a huge amount of time
to run especially on large projects. For this the `coala-quickstart` will
have a `lite-mode`. We assume that the lowest level in which there can be
variations will be file types as a starting point, we try to guess the
settings not from the entire project, but for each file type, we grab a set
of files at random and run coala and again look for *green* settings, if we
find a value for a setting as *"green"*, we add it to the config file, if
not we drop the setting/bear. This mode is error prone, but is a lot
faster than the brute force way. **NOTE:** The successive runs of the
`lite-mode` should build upon the data from the previous runs to generate
less error prone (less error prone over here indicates not likely to generate
errors in the project), so that running `lite-mode` a number of times is still
faster than Brute Force. We choose this method as it is highly
unlikely that different files among the same file types have a different
set of codestyle rules in a project.
There can be endless number of possibilities and assumptions:

- Files having similar kind of names can be having different codestyles.
- Files in a given directory can be following different codestyles.
- Different parts of files maybe even following a differnet codestyle depending
  on function name which can also be handled by placing `ignore`s at
  appropriate places in the file dict, such kind of functionality can only be
  added to the bears themselves, but instead we stop our train of thought over
  here.

## Learning from real world projects

We save ourselves the additional work for building some feature that may
hardly ever be used by any org, instead we stop assumming and start
implementing and learning from our available resources.

We now choose a list of orgs for which we try to test our `green-mode`
ourselves. We check whether brute force is taking too much time or whether
the `lite-mode` is producing the correct results (i.e. *green* results). We
choose these orgs in such a way that they are very famous or very well known or
act as upstream repositories for a huge amount of orgs. This way a very large
number of orgs may be mimicking the code style of these orgs itself and if
our further optimizations can fix the problem of generating *green* config
files for these organizations, we are in turn solving the problem for these
other orgs/communities at the same time.

We learn manually from these orgs, what combinations of these bear-setting
values are they using, whether they are using it all over their project or only
in certain scenarious, whether they have different codestyles in different
directories or different nomenclature of file patterns require a different
set of settings in their project. We give `coala-quickstart`, the ability
to learn and identify these patterns, recognizing these scenarios for further
runs.

# Developing tools for a better future

`coala-quickstart` should also develop custom logs which make further
developing and identifying the cause of our config files to generate errors
more evident and easier to grasp for further development. It is possible that
we may have to apply some other set of rules if we identify a regex pattern.
The regex pattern identification will have to be done manually but once the regex
is formed, and provided we find this a problem in our chosen orgs, helper
functions/classes should be developed for the bears so that they are able to
put `ignore`s at correct places in the `file_dict` on identifying the regex and
use different bear settings for different portions of the file itself.
**(Stretch Goal)**

# Engaging newcomers to spread the word about coala

We can only look at a finite number of orgs within the coding period so the
last few weeks of the project should deal with writing docs and adding newcomer
tasks for either opening PRs in other orgs of the *green* config files or
notifying us of the results if they are not able to generate one and opening
issues for further improvement.
